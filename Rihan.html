<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>InnovAid</title>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Inter", sans-serif;
        background: rgba(255, 255, 255, 0.8);
        min-height: 100vh;
      }

      .gradient-text {
        background: linear-gradient(135deg, #5b9279 0%, #8fcb9b 100%);
        background-clip: text;
        -webkit-text-fill-color: transparent;
      }

      .gradient-bg {
        background: linear-gradient(135deg, #5b9279 0%, #8fcb9b 100%);
      }

      .glass-card {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.5);
        box-shadow: 0 20px 40px -5px rgba(0, 0, 0, 0.05),
          0 10px 20px -5px rgba(0, 0, 0, 0.02);
      }

      .glass-nav {
        background: rgba(255, 255, 255, 0.8);
        backdrop-filter: blur(12px);
        border-bottom: 1px solid rgba(255, 255, 255, 0.3);
      }

      .tab-transition {
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      }

      .input-group {
        transition: transform 0.2s ease;
      }

      .input-field:focus-within {
        transform: translateY(-1px);
      }

      /* Custom focus ring matching the theme */
      .custom-focus:focus {
        outline: none;
        border-color: #6366f1;
        box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
      }

      /* Scrollbar hide */
      .no-scrollbar::-webkit-scrollbar {
        display: none;
      }
      .no-scrollbar {
        -ms-overflow-style: none;
        scrollbar-width: none;
      }

      .project-card {
        transition: transform 0.2s ease, box-shadow 0.2s ease;
      }
      .project-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1),
          0 10px 10px -5px rgba(0, 0, 0, 0.04);
      }

      /* Custom scrollbar for modal content */
      .custom-scrollbar::-webkit-scrollbar {
        width: 6px;
      }
      .custom-scrollbar::-webkit-scrollbar-track {
        background: #f1f1f1;
        border-radius: 4px;
      }
      .custom-scrollbar::-webkit-scrollbar-thumb {
        background: #d1d5db;
        border-radius: 4px;
      }
      .custom-scrollbar::-webkit-scrollbar-thumb:hover {
        background: #9ca3af;
      }
    </style>
  </head>
  <body>
    <!-- LOGIN VIEW -->
    <div
      id="login-view"
      class="min-h-screen flex items-center justify-center p-4 sm:p-8 transition-opacity duration-500"
    >
      <div class="w-full max-w-md">
        <!-- Header Section -->
        <div class="text-center mb-8">
          <h1 class="text-4xl font-bold tracking-tight mb-2 gradient-text">
            InnovAid
          </h1>
          <p class="text-gray-500 text-sm font-medium">
            Empowering student innovation through micro-funding
          </p>
        </div>

        <!-- Main Card -->
        <div
          class="glass-card rounded-[24px] p-8 w-full relative overflow-hidden"
        >
          <!-- Role Selection Tabs -->
          <div class="flex bg-gray-100 p-1.5 rounded-full mb-8 relative">
            <div
              id="tab-bg"
              class="absolute top-1.5 bottom-1.5 w-[calc(50%-6px)] bg-white rounded-full shadow-sm transition-all duration-300 ease-in-out left-1.5"
            ></div>
            <button
              onclick="switchTab('student')"
              id="student-tab"
              class="flex-1 relative z-10 text-sm font-semibold py-2.5 text-center rounded-full transition-colors duration-300 text-gray-900"
            >
              Student Login
            </button>
            <button
              onclick="switchTab('donor')"
              id="donor-tab"
              class="flex-1 relative z-10 text-sm font-semibold py-2.5 text-center rounded-full transition-colors duration-300 text-gray-500"
            >
              Donor Login
            </button>
          </div>

          <!-- Login Form -->
          <form id="login-form" onsubmit="handleLogin(event)" class="space-y-5">
            <!-- Email -->
            <div class="space-y-1.5 input-group">
              <label
                for="email"
                class="text-sm font-medium text-gray-700 block pl-1"
                >Email Address</label
              >
              <input
                type="email"
                id="email"
                class="input-field w-full px-4 py-3 rounded-xl border border-gray-200 bg-gray-50/50 text-gray-900 text-sm transition-all duration-200 custom-focus hover:border-gray-300"
                placeholder="name@example.com"
              />
              <p id="email-error" class="hidden text-xs text-red-500 pl-1">
                Please enter a valid email address.
              </p>
            </div>

            <!-- Password -->
            <div class="space-y-1.5 input-group">
              <div class="flex justify-between items-center pl-1">
                <label for="password" class="text-sm font-medium text-gray-700"
                  >Password</label
                >
                <a
                  href="#"
                  onclick="showForgot()"
                  class="text-xs font-medium text-blue-600 hover:text-blue-700 transition-colors"
                  >Forgot Password?</a
                >
              </div>
              <input
                type="password"
                id="password"
                class="input-field w-full px-4 py-3 rounded-xl border border-gray-200 bg-gray-50/50 text-gray-900 text-sm transition-all duration-200 custom-focus hover:border-gray-300"
                placeholder="••••••••"
              />
              <p id="password-error" class="hidden text-xs text-red-500 pl-1">
                Password is required.
              </p>
            </div>

            <!-- Action Button -->
            <button
              type="submit"
              class="w-full gradient-bg text-white font-semibold py-3.5 rounded-xl shadow-lg shadow-blue-500/20 hover:shadow-blue-500/30 hover:translate-y-[-1px] active:translate-y-[1px] transition-all duration-200 text-sm mt-2"
            >
              Sign In
            </button>

            <!-- Divider -->
            <div class="relative py-2">
              <div class="absolute inset-0 flex items-center">
                <div class="w-full border-t border-gray-100"></div>
              </div>
              <div class="relative flex justify-center text-xs uppercase">
                <span
                  class="bg-white px-3 text-gray-400 tracking-wider font-medium"
                  >Or continue with</span
                >
              </div>
            </div>

            <!-- Google Button -->
            <button
              type="button"
              class="w-full bg-white border border-gray-200 text-gray-700 font-medium py-3 rounded-xl hover:bg-gray-50 hover:border-gray-300 transition-all duration-200 text-sm flex items-center justify-center gap-2"
            >
              <svg class="w-5 h-5" viewBox="0 0 24 24">
                <path
                  d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"
                  fill="#4285F4"
                />
                <path
                  d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"
                  fill="#34A853"
                />
                <path
                  d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"
                  fill="#FBBC05"
                />
                <path
                  d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"
                  fill="#EA4335"
                />
              </svg>
              Google
            </button>
          </form>

          <!-- Footer -->
          <div class="mt-8 text-center">
            <p class="text-sm text-gray-600">
              Don't have an account?
              <a
                href="#"
                onclick="openSignUp()"
                class="font-semibold text-blue-600 hover:text-purple-600 transition-colors"
                >Sign Up</a
              >
            </p>
          </div>
        </div>
        <div class="text-center mt-8 opacity-60">
          <p
            class="text-xs font-medium text-gray-400 uppercase tracking-widest"
          >
            InnovAid — Hackathon Edition
          </p>
        </div>
      </div>
    </div>

    <!-- SIGNUP VIEW -->
    <div
      id="signup-view"
      class="hidden min-h-screen flex items-center justify-center p-4 sm:p-8 transition-opacity duration-500"
    >
      <div class="w-full max-w-md">
        <!-- Header Section -->
        <div class="text-center mb-8">
          <h1 class="text-4xl font-bold tracking-tight mb-2 gradient-text">
            LMArena
          </h1>
          <p class="text-gray-500 text-sm font-medium">
            Join the future of student innovation
          </p>
        </div>

        <!-- Main Card -->
        <div
          class="glass-card rounded-[24px] p-8 w-full relative overflow-hidden"
        >
          <!-- Role Selection Tabs (Signup) -->
          <div class="flex bg-gray-100 p-1.5 rounded-full mb-6 relative">
            <div
              id="signup-tab-bg"
              class="absolute top-1.5 bottom-1.5 w-[calc(50%-6px)] bg-white rounded-full shadow-sm transition-all duration-300 ease-in-out left-1.5"
            ></div>
            <button
              onclick="switchSignupTab('student')"
              id="signup-student-tab"
              class="flex-1 relative z-10 text-sm font-semibold py-2.5 text-center rounded-full transition-colors duration-300 text-gray-900"
            >
              I'm a Student
            </button>
            <button
              onclick="switchSignupTab('donor')"
              id="signup-donor-tab"
              class="flex-1 relative z-10 text-sm font-semibold py-2.5 text-center rounded-full transition-colors duration-300 text-gray-500"
            >
              I'm a Donor
            </button>
          </div>

          <!-- Signup Form -->
          <form
            id="signup-form"
            onsubmit="handleSignup(event)"
            class="space-y-4"
          >
            <!-- Name -->
            <div class="space-y-1.5 input-group">
              <label
                for="signup-name"
                class="text-sm font-medium text-gray-700 block pl-1"
                >Full Name</label
              >
              <input
                type="text"
                id="signup-name"
                class="input-field w-full px-4 py-3 rounded-xl border border-gray-200 bg-gray-50/50 text-gray-900 text-sm transition-all duration-200 custom-focus hover:border-gray-300"
                placeholder="John Doe"
              />
            </div>

            <!-- Email -->
            <div class="space-y-1.5 input-group">
              <label
                for="signup-email"
                class="text-sm font-medium text-gray-700 block pl-1"
                >Email Address</label
              >
              <input
                type="email"
                id="signup-email"
                class="input-field w-full px-4 py-3 rounded-xl border border-gray-200 bg-gray-50/50 text-gray-900 text-sm transition-all duration-200 custom-focus hover:border-gray-300"
                placeholder="name@example.com"
              />
            </div>

            <!-- Password -->
            <div class="space-y-1.5 input-group">
              <label
                for="signup-password"
                class="text-sm font-medium text-gray-700 block pl-1"
                >Password</label
              >
              <input
                type="password"
                id="signup-password"
                class="input-field w-full px-4 py-3 rounded-xl border border-gray-200 bg-gray-50/50 text-gray-900 text-sm transition-all duration-200 custom-focus hover:border-gray-300"
                placeholder="Create a strong password"
              />
            </div>

            <!-- Confirm Password -->
            <div class="space-y-1.5 input-group">
              <label
                for="signup-confirm-password"
                class="text-sm font-medium text-gray-700 block pl-1"
                >Confirm Password</label
              >
              <input
                type="password"
                id="signup-confirm-password"
                class="input-field w-full px-4 py-3 rounded-xl border border-gray-200 bg-gray-50/50 text-gray-900 text-sm transition-all duration-200 custom-focus hover:border-gray-300"
                placeholder="Repeat password"
              />
            </div>

            <!-- Action Button -->
            <button
              type="submit"
              class="w-full gradient-bg text-white font-semibold py-3.5 rounded-xl shadow-lg shadow-blue-500/20 hover:shadow-blue-500/30 hover:translate-y-[-1px] active:translate-y-[1px] transition-all duration-200 text-sm mt-2"
            >
              Create Account
            </button>
          </form>

          <!-- Footer -->
          <div class="mt-6 text-center">
            <p class="text-sm text-gray-600">
              Already have an account?
              <button
                onclick="toggleAuthView('login')"
                class="font-semibold text-blue-600 hover:text-purple-600 transition-colors"
              >
                Log In
              </button>
            </p>
          </div>
        </div>
        <div class="text-center mt-8 opacity-60">
          <p
            class="text-xs font-medium text-gray-400 uppercase tracking-widest"
          >
            InnovAid — Hackathon Edition
          </p>
        </div>
      </div>
    </div>

    <!-- DASHBOARD VIEW -->
    <div id="dashboard-view" class="hidden w-full min-h-screen pb-20">
      <!-- Navbar -->
      <nav class="glass-nav sticky top-0 z-50 w-full px-4 sm:px-8 py-4">
        <div class="max-w-7xl mx-auto flex items-center justify-between">
          <!-- Logo -->
          <div class="flex items-center gap-2">
            <h1 class="text-2xl font-bold gradient-text tracking-tight">
              InnovAid
            </h1>
            <span
              id="role-badge"
              class="hidden sm:inline-block px-2 py-0.5 text-[10px] font-bold uppercase tracking-wider bg-gray-100 text-gray-500 rounded-full"
              >Student</span
            >
          </div>

          <!-- Desktop Tabs -->
          <div
            id="desktop-tabs"
            class="hidden md:flex items-center gap-1 bg-gray-100/50 p-1 rounded-full backdrop-blur-sm"
          >
            <!-- Injected by JS -->
          </div>

          <!-- Profile -->
          <div class="flex items-center gap-3">
            <div class="hidden sm:flex flex-col text-right">
              <span class="text-sm font-semibold text-gray-900"
                >Shamil SJ</span
              >
              <span class="text-xs text-gray-500">Level 3 Creator</span>
            </div>
            <div class="relative group">
              <button
                class="w-10 h-10 rounded-full gradient-bg p-[2px] cursor-pointer transition-transform hover:scale-105"
              >
                <div
                  class="w-full h-full rounded-full bg-white overflow-hidden"
                >
                  <img
                    src="https://api.dicebear.com/7.x/avataaars/svg?seed=Alex"
                    alt="Profile"
                    class="w-full h-full object-cover"
                  />
                </div>
              </button>
              <!-- Dropdown -->
              <div
                class="absolute right-0 mt-2 w-48 bg-white rounded-xl shadow-lg border border-gray-100 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 transform origin-top-right"
              >
                <div class="p-2">
                  <a
                    href="#"
                    class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 rounded-lg"
                    >Profile Settings</a
                  >
                  <a
                    href="#"
                    class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 rounded-lg"
                    >Help Center</a
                  >
                  <div class="h-px bg-gray-100 my-1"></div>
                  <button
                    onclick="handleLogout()"
                    class="w-full text-left px-4 py-2 text-sm text-red-600 hover:bg-red-50 rounded-lg"
                  >
                    Sign Out
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
        <!-- Mobile Tabs (Scrollable) -->
        <div
          id="mobile-tabs"
          class="md:hidden mt-4 overflow-x-auto no-scrollbar flex items-center gap-2 pb-1"
        >
          <!-- Injected by JS -->
        </div>
      </nav>

      <!-- Main Content Area -->
      <main class="max-w-7xl mx-auto px-4 sm:px-8 py-8">
        <div id="main-content" class="w-full">
          <!-- Injected by JS -->
        </div>
      </main>

      <!-- Floating Action Button (Student Only) -->
      <button
        id="fab-upload"
        onclick="switchDashboardTab('Upload Project')"
        class="hidden fixed bottom-8 right-8 z-40 group"
      >
        <div
          class="absolute inset-0 gradient-bg rounded-full blur opacity-40 group-hover:opacity-70 transition-opacity"
        ></div>
        <div
          class="relative bg-gray-900 text-white p-4 rounded-full shadow-xl flex items-center gap-2 hover:scale-105 transition-transform"
        >
          <svg
            class="w-6 h-6"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M12 4v16m8-8H4"
            ></path>
          </svg>
          <span class="pr-2 font-medium">New Project</span>
        </div>
      </button>
    </div>

    <!-- MODAL COMPONENT -->
    <div id="universal-modal" class="fixed inset-0 z-[100] hidden">
      <!-- Backdrop -->
      <div
        class="absolute inset-0 bg-black/60 backdrop-blur-sm transition-opacity opacity-0"
        id="modal-backdrop"
        onclick="closeModal()"
      ></div>

      <!-- Modal Content -->
      <div
        class="absolute inset-0 flex items-center justify-center p-4 pointer-events-none"
      >
        <div
          id="modal-content"
          class="bg-white rounded-[2rem] w-full max-w-2xl shadow-2xl transform scale-95 opacity-0 transition-all duration-300 pointer-events-auto relative overflow-hidden max-h-[90vh] flex flex-col"
        >
          <!-- Injected Content -->
        </div>
      </div>
    </div>

    <script>
      // --- Configuration ---
      const firebaseConfig = {
        apiKey: "AIzaSyDzVsC3ZYgp4Q8pNFUggDZWQQHEdmRcKpU",
        authDomain: "project-funding-74ad6.firebaseapp.com",
        projectId: "project-funding-74ad6",
        storageBucket: "project-funding-74ad6.firebasestorage.app",
        messagingSenderId: "316427179272",
        appId: "1:316427179272:web:417bab2d188caa4d8848bd",
        measurementId: "G-1PXK2SK56C",
      };

      const GEMINI_API_KEY = "AIzaSyBzurxPl1gPAMGD8pPKTm3FL-B_xfkmY2E";

      // Initialize Firebase
      let db;
      try {
        firebase.initializeApp(firebaseConfig);
        db = firebase.firestore();
        console.log("Firebase initialized");
      } catch (e) {
        console.error("Firebase init error", e);
      }

      let currentRole = "student"; // Default for login selection
      let userRole = null; // Set after login

      // Chat State
      window.conversations = [];
      window.activeChatId = null;
      window.conversationsInitialized = false;

      function initMockConversations() {
        const commonMsgs = [
          {
            sender: "them",
            text: "Hi there! I saw your project and found it very interesting.",
            time: "10:30 AM",
          },
          {
            sender: "me",
            text: "Thank you! We are working hard on the prototype.",
            time: "10:32 AM",
          },
        ];

        if (userRole === "student") {
          window.conversations = [
            {
              id: 1,
              name: "Marcus Investor",
              role: "Angel Donor",
              avatar: "Marcus",
              online: true,
              messages: [
                ...commonMsgs,
                {
                  sender: "them",
                  text: "Would you be open to a call next week?",
                  time: "10:35 AM",
                },
              ],
            },
            {
              id: 2,
              name: "Sarah Ventures",
              role: "VC Scout",
              avatar: "Sarah",
              online: false,
              messages: [
                {
                  sender: "them",
                  text: "Congrats on the funding milestone!",
                  time: "Yesterday",
                },
              ],
            },
            {
              id: 3,
              name: "Green Tech Fund",
              role: "Organization",
              avatar: "Green",
              online: true,
              messages: [
                {
                  sender: "me",
                  text: "Here is the pitch deck you requested.",
                  time: "2 days ago",
                },
              ],
            },
          ];
        } else {
          window.conversations = [
            {
              id: 1,
              name: "Shamil SJ",
              role: "Student • EcoDrone",
              avatar: "Alex",
              online: true,
              messages: [
                ...commonMsgs,
                {
                  sender: "them",
                  text: "Do you have any specific questions about our roadmap?",
                  time: "11:00 AM",
                },
              ],
            },
            {
              id: 2,
              name: "David Chen",
              role: "Student • NeuroLink",
              avatar: "David",
              online: false,
              messages: [
                {
                  sender: "me",
                  text: "I just contributed to your campaign. Good luck!",
                  time: "Yesterday",
                },
              ],
            },
            {
              id: 3,
              name: "Green Team",
              role: "Student Group",
              avatar: "Team",
              online: true,
              messages: [
                {
                  sender: "them",
                  text: "Thanks for the support!",
                  time: "3 days ago",
                },
              ],
            },
          ];
        }
      }

      function renderContactsList() {
        return window.conversations
          .map(
            (c) => `
                <button onclick="openChat(${
                  c.id
                })" class="w-full p-3 flex items-center gap-3 hover:bg-gray-100 transition-colors rounded-xl text-left ${
              window.activeChatId === c.id
                ? "bg-blue-50 border-blue-100 ring-1 ring-blue-100"
                : ""
            }">
                    <div class="relative">
                        <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=${
                          c.avatar
                        }" class="w-12 h-12 rounded-full bg-white border border-gray-200">
                        ${
                          c.online
                            ? '<div class="absolute bottom-0 right-0 w-3 h-3 bg-green-500 border-2 border-white rounded-full"></div>'
                            : ""
                        }
                    </div>
                    <div class="flex-1 min-w-0">
                        <div class="flex justify-between items-center mb-0.5">
                            <h4 class="font-bold text-gray-900 truncate text-sm">${
                              c.name
                            }</h4>
                            <span class="text-xs text-gray-400">${
                              c.messages[c.messages.length - 1].time
                            }</span>
                        </div>
                        <p class="text-xs text-gray-500 truncate">${
                          c.messages[c.messages.length - 1].sender === "me"
                            ? "You: "
                            : ""
                        }${c.messages[c.messages.length - 1].text}</p>
                    </div>
                </button>
            `
          )
          .join("");
      }

      function openChat(id) {
        window.activeChatId = id;
        renderContent("Messages"); // Re-render to show chat view
      }

      function backToContacts() {
        window.activeChatId = null;
        renderContent("Messages");
      }

      function renderActiveChat() {
        const chat = window.conversations.find(
          (c) => c.id === window.activeChatId
        );
        if (!chat) return "";

        return `
                <!-- Chat Header -->
                <div class="p-4 border-b border-gray-100 flex items-center gap-3 bg-white z-10 shadow-sm">
                    <button onclick="backToContacts()" class="md:hidden p-2 -ml-2 text-gray-500 hover:bg-gray-100 rounded-full">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
                    </button>
                    <div class="w-10 h-10 rounded-full bg-gray-100 overflow-hidden border border-gray-200">
                        <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=${
                          chat.avatar
                        }" class="w-full h-full object-cover">
                    </div>
                    <div>
                        <h4 class="font-bold text-gray-900 text-sm leading-tight">${
                          chat.name
                        }</h4>
                        <span class="text-xs text-gray-500">${chat.role} • ${
          chat.online
            ? '<span class="text-green-600 font-medium">Online</span>'
            : "Offline"
        }</span>
                    </div>
                    <button class="ml-auto p-2 text-gray-400 hover:bg-gray-50 rounded-full">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z"></path></svg>
                    </button>
                </div>

                <!-- Messages List -->
                <div class="flex-1 overflow-y-auto p-4 space-y-4 bg-slate-50 custom-scrollbar" id="messages-container">
                    ${chat.messages
                      .map(
                        (msg) => `
                        <div class="flex ${
                          msg.sender === "me" ? "justify-end" : "justify-start"
                        }">
                            <div class="max-w-[75%] ${
                              msg.sender === "me"
                                ? "bg-blue-600 text-white rounded-2xl rounded-tr-sm"
                                : "bg-white border border-gray-200 text-gray-800 rounded-2xl rounded-tl-sm"
                            } px-4 py-2.5 shadow-sm">
                                <p class="text-sm">${msg.text}</p>
                                <p class="text-[10px] ${
                                  msg.sender === "me"
                                    ? "text-blue-200"
                                    : "text-gray-400"
                                } mt-1 text-right">${msg.time}</p>
                            </div>
                        </div>
                    `
                      )
                      .join("")}
                </div>

                <!-- Input Area -->
                <div class="p-4 bg-white border-t border-gray-100">
                    <form onsubmit="handleSendMessage(event)" class="flex items-center gap-2">
                        <button type="button" class="p-2 text-gray-400 hover:bg-gray-100 rounded-full transition-colors">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13"></path></svg>
                        </button>
                        <input type="text" id="msg-input" class="flex-1 px-4 py-2.5 bg-gray-50 border border-gray-200 rounded-full text-sm focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500 transition-all" placeholder="Type a message..." autocomplete="off">
                        <button type="submit" class="p-2.5 bg-blue-600 text-white rounded-full hover:bg-blue-700 transition-transform active:scale-95 shadow-md">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path></svg>
                        </button>
                    </form>
                </div>
            `;
      }

      function handleSendMessage(e) {
        e.preventDefault();
        const input = document.getElementById("msg-input");
        const text = input.value.trim();

        if (!text || !window.activeChatId) return;

        const chat = window.conversations.find(
          (c) => c.id === window.activeChatId
        );
        if (chat) {
          // Add user message
          chat.messages.push({
            sender: "me",
            text: text,
            time: "Just now",
          });

          input.value = "";
          renderContent("Messages"); // Re-render to show new message

          // Simulate Reply
          setTimeout(() => {
            chat.messages.push({
              sender: "them",
              text: "That sounds great! I'll take a look.",
              time: "Just now",
            });
            // Only re-render if still on that chat
            if (window.activeChatId === chat.id) {
              renderContent("Messages");
              const msgContainer =
                document.getElementById("messages-container");
              if (msgContainer)
                msgContainer.scrollTop = msgContainer.scrollHeight;
            }
          }, 2000);
        }
      }

      // Mock User Stats (for Credit Score calculation)
      let userStats = {
        problemsUploaded: 12,
        approvedProjects: 8,
        activeness: 9,
        creditScore: 94, // Initial score
        name: "Shamil SJ",
        raised: 5200,
      };

      // Data Stores
      let projects = [
        {
          id: 1,
          title: "EcoDrone: Reforestation AI",
          creator: "Sarah Jenkins",
          role: "Computer Science Student",
          desc: "Autonomous drone swarms capable of planting 10,000 trees a day using biodegradable seed pods.",
          image:
            "https://i0.wp.com/ecording.org/wp-content/uploads/2023/05/forestation-ecodrone.jpeg?fit=2560%2C1707&ssl=1",
          goal: 5000,
          raised: 3250,
          score: 94,
          category: "Sustainability",
        },
        {
          id: 2,
          title: "NeuroLink Assistive Tech",
          creator: "David Chen",
          role: "Biomedical Engineering",
          desc: "Affordable brain-computer interface headset for patients with locked-in syndrome to communicate.",
          image:
            "https://images.unsplash.com/photo-1555255707-c07966088b7b?auto=format&fit=crop&q=80&w=800",
          goal: 2500,
          raised: 2100,
          score: 88,
          category: "HealthTech",
        },
        {
          id: 3,
          title: "SmartCampus Recycle Bin",
          creator: "Green Team",
          role: "Environmental Club",
          desc: "IoT-enabled bins that automatically sort waste using computer vision and reward students with crypto-tokens.",
          image:
            "https://images.unsplash.com/photo-1532996122724-e3c354a0b15b?auto=format&fit=crop&q=80&w=800",
          goal: 800,
          raised: 150,
          score: 76,
          category: "IoT",
        },
        {
          id: 4,
          title: "EduVR History Lessons",
          creator: "Maya Patel",
          role: "Education & Tech",
          desc: "Immersive VR experiences allowing students to witness historical events firsthand.",
          image:
            "https://png.pngtree.com/png-clipart/20240416/original/pngtree-history-learn-educational-lesson-landing-header-vector-png-image_14867001.png",
          goal: 1200,
          raised: 450,
          score: 82,
          category: "EdTech",
        },
        {
          id: 5,
          title: "Urban Vertical Farm",
          creator: "Marcus Lee",
          role: "Agricultural Science",
          desc: "Compact hydroponic units designed for apartment balconies to grow fresh produce year-round.",
          image:
            "https://images.unsplash.com/photo-1530836369250-ef72a3f5cda8?auto=format&fit=crop&q=80&w=800",
          goal: 3500,
          raised: 1200,
          score: 91,
          category: "Sustainability",
        },
        {
          id: 6,
          title: "SignLingo AI",
          creator: "Team Vision",
          role: "Computer Vision Lab",
          desc: "Real-time sign language translation app using mobile camera to bridge communication gaps.",
          image:
            "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRpcuo79DicfKz2Fa8NcJ0DRfEUqbcj1cWvZA&s",
          goal: 4000,
          raised: 3800,
          score: 97,
          category: "AI & ML",
        },
        {
          id: 7,
          title: "SolarWeave Backpack",
          creator: "Elena Rodriguez",
          role: "Product Design",
          desc: "Ergonomic backpack with integrated flexible solar panels to charge devices on the go.",
          image:
            "https://images.unsplash.com/photo-1553062407-98eeb64c6a62?auto=format&fit=crop&q=80&w=800",
          goal: 1500,
          raised: 300,
          score: 85,
          category: "IoT",
        },
        {
          id: 8,
          title: "BioWrap Packaging",
          creator: "Green Chemists",
          role: "Chemical Engineering",
          desc: "Algae-based biodegradable packaging material to replace single-use plastics in cafeterias.",
          image:
            "https://images.unsplash.com/photo-1620916297397-a4a5402a3c6c?auto=format&fit=crop&q=80&w=800",
          goal: 6000,
          raised: 1500,
          score: 89,
          category: "Sustainability",
        },
        {
          id: 9,
          title: "MediDrone Express",
          creator: "James Foster",
          role: "Robotics Engineering",
          desc: "High-speed delivery drones for transporting urgent medical supplies between campus clinics.",
          image:
            "https://images.unsplash.com/photo-1579829366248-204fe8413f31?auto=format&fit=crop&q=80&w=800",
          goal: 8500,
          raised: 2100,
          score: 93,
          category: "HealthTech",
        },
      ];

      // --- Login Logic ---

      function switchTab(role) {
        currentRole = role;
        const bg = document.getElementById("tab-bg");
        const studentTab = document.getElementById("student-tab");
        const donorTab = document.getElementById("donor-tab");

        if (role === "student") {
          bg.style.left = "6px";
          studentTab.classList.remove("text-gray-500");
          studentTab.classList.add("text-gray-900");
          donorTab.classList.remove("text-gray-900");
          donorTab.classList.add("text-gray-500");
        } else {
          bg.style.left = "50%";
          donorTab.classList.remove("text-gray-500");
          donorTab.classList.add("text-gray-900");
          studentTab.classList.remove("text-gray-900");
          studentTab.classList.add("text-gray-500");
        }
      }

      function handleLogin(e) {
        e.preventDefault();
        const email = document.getElementById("email");
        const password = document.getElementById("password");
        const emailError = document.getElementById("email-error");
        const passwordError = document.getElementById("password-error");

        let isValid = true;

        // Reset errors
        email.classList.remove("border-red-500", "bg-red-50");
        password.classList.remove("border-red-500", "bg-red-50");
        emailError.classList.add("hidden");
        passwordError.classList.add("hidden");

        if (!email.value || !email.value.includes("@")) {
          email.classList.add("border-red-500", "bg-red-50");
          emailError.classList.remove("hidden");
          isValid = false;
        }
        if (!password.value) {
          password.classList.add("border-red-500", "bg-red-50");
          passwordError.classList.remove("hidden");
          isValid = false;
        }

        if (isValid) {
          const btn = e.target.querySelector('button[type="submit"]');
          const originalText = btn.innerText;
          btn.innerHTML =
            '<svg class="animate-spin h-5 w-5 text-white mx-auto" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>';

          setTimeout(() => {
            btn.innerText = originalText;
            userRole = currentRole;
            initDashboard();
          }, 1000);
        }
      }

      function handleLogout() {
        document.getElementById("dashboard-view").classList.add("hidden");
        document.getElementById("login-view").classList.remove("hidden");
        // Reset form
        document.getElementById("login-form").reset();
      }

      // --- Signup Logic ---

      let currentSignupRole = "student";

      function toggleAuthView(view) {
        const loginView = document.getElementById("login-view");
        const signupView = document.getElementById("signup-view");

        if (view === "signup") {
          loginView.classList.add("hidden");
          signupView.classList.remove("hidden");
        } else {
          signupView.classList.add("hidden");
          loginView.classList.remove("hidden");
        }
      }

      function switchSignupTab(role) {
        currentSignupRole = role;
        const bg = document.getElementById("signup-tab-bg");
        const studentTab = document.getElementById("signup-student-tab");
        const donorTab = document.getElementById("signup-donor-tab");

        if (role === "student") {
          bg.style.left = "6px";
          studentTab.classList.remove("text-gray-500");
          studentTab.classList.add("text-gray-900");
          donorTab.classList.remove("text-gray-900");
          donorTab.classList.add("text-gray-500");
        } else {
          bg.style.left = "50%";
          donorTab.classList.remove("text-gray-500");
          donorTab.classList.add("text-gray-900");
          studentTab.classList.remove("text-gray-900");
          studentTab.classList.add("text-gray-500");
        }
      }

      function handleSignup(e) {
        e.preventDefault();
        const name = document.getElementById("signup-name");
        const email = document.getElementById("signup-email");
        const password = document.getElementById("signup-password");
        const confirm = document.getElementById("signup-confirm-password");

        // Basic Validation
        if (!name.value || !email.value || !password.value) {
          alert("Please fill in all fields");
          return;
        }
        if (password.value !== confirm.value) {
          alert("Passwords do not match");
          return;
        }

        const btn = e.target.querySelector('button[type="submit"]');
        const originalText = btn.innerText;
        btn.innerHTML =
          '<svg class="animate-spin h-5 w-5 text-white mx-auto" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>';

        // Mock Signup Process
        setTimeout(() => {
          btn.innerText = originalText;
          // Set global user role based on signup selection
          userRole = currentSignupRole;
          userStats.name = name.value; // Update mock name

          // Reset form
          document.getElementById("signup-form").reset();
          document.getElementById("signup-view").classList.add("hidden");

          // Go straight to dashboard
          initDashboard();
        }, 1500);
      }

      // --- Dashboard Logic ---

      function initDashboard() {
        document.getElementById("login-view").classList.add("hidden");
        document.getElementById("dashboard-view").classList.remove("hidden");

        // Setup UI based on role
        const roleBadge = document.getElementById("role-badge");
        roleBadge.innerText = userRole;

        const fab = document.getElementById("fab-upload");
        if (userRole === "student") {
          fab.classList.remove("hidden");
        } else {
          fab.classList.add("hidden");
        }

        renderNavigation();
        // Load initial tab
        const initialTab = userRole === "student" ? "Home Feed" : "Recommended";
        switchDashboardTab(initialTab);
      }

      const studentTabs = [
        "Home Feed",
        "Upload Project",
        "Track Funding",
        "Messages",
        "Profile",
      ];
      const donorTabs = [
        "Recommended",
        "Explore",
        "Your Funding",
        "Messages",
        "Profile",
      ];

      function renderNavigation() {
        const tabs = userRole === "student" ? studentTabs : donorTabs;
        const desktopContainer = document.getElementById("desktop-tabs");
        const mobileContainer = document.getElementById("mobile-tabs");

        const generateTabsHTML = (isMobile) =>
          tabs
            .map(
              (tab) => `
                <button onclick="switchDashboardTab('${tab}')" 
                    class="dashboard-tab px-4 py-2 rounded-full text-sm font-medium transition-all duration-200 whitespace-nowrap
                    ${
                      isMobile
                        ? "border border-gray-200 bg-white"
                        : "hover:bg-white hover:shadow-sm text-gray-600"
                    }"
                    data-tab="${tab}">
                    ${tab}
                </button>
            `
            )
            .join("");

        desktopContainer.innerHTML = generateTabsHTML(false);
        mobileContainer.innerHTML = generateTabsHTML(true);
      }

      function switchDashboardTab(tabName) {
        // Update active state visual
        document.querySelectorAll(".dashboard-tab").forEach((btn) => {
          if (btn.dataset.tab === tabName) {
            btn.classList.remove(
              "text-gray-600",
              "bg-white",
              "border-gray-200"
            );
            btn.classList.add(
              "bg-white",
              "text-blue-600",
              "shadow-sm",
              "ring-1",
              "ring-gray-100"
            );
            if (btn.parentElement.id === "desktop-tabs")
              btn.classList.add("font-semibold");
          } else {
            btn.classList.add("text-gray-600");
            btn.classList.remove(
              "bg-white",
              "text-blue-600",
              "shadow-sm",
              "ring-1",
              "ring-gray-100",
              "font-semibold"
            );
            if (btn.parentElement.id === "mobile-tabs")
              btn.classList.add("bg-white", "border-gray-200");
          }
        });

        renderContent(tabName);
      }

      function renderContent(tabName) {
        const container = document.getElementById("main-content");

        // --- HOME FEED / RECOMMENDED ---
        if (tabName === "Home Feed" || tabName === "Recommended") {
          container.innerHTML = `
                    <div class="mb-6 flex items-center justify-between">
                        <h2 class="text-xl font-bold text-gray-900">${
                          tabName === "Recommended"
                            ? "Recommended for You"
                            : "Recent Activity"
                        }</h2>
                        <button class="text-sm font-medium text-blue-600 hover:text-blue-700">View All</button>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        ${projects.map((p) => createProjectCard(p)).join("")}
                    </div>
                `;
        }
        // --- EXPLORE ---
        else if (tabName === "Explore") {
          container.innerHTML = `
                    <div class="mb-6">
                        <div class="relative">
                            <input type="text" placeholder="Search projects, tags, or creators..." class="w-full pl-10 pr-4 py-3 rounded-xl border border-gray-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-100 outline-none transition-all">
                            <svg class="w-5 h-5 text-gray-400 absolute left-3 top-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        ${projects
                          .reverse()
                          .map((p) => createProjectCard(p))
                          .join("")}
                    </div>
                `;
        }
        // --- UPLOAD PROJECT (Student) ---
        else if (tabName === "Upload Project") {
          container.innerHTML = `
                    <div class="max-w-2xl mx-auto">
                        <div class="bg-white rounded-2xl p-6 sm:p-8 shadow-sm border border-gray-100">
                            <div class="text-center mb-8">
                                <h2 class="text-2xl font-bold text-gray-900">Create New Project</h2>
                                <p class="text-gray-500 mt-1">Share your innovation with the world</p>
                            </div>
                            <form id="upload-form" onsubmit="handleProjectUpload(event)" class="space-y-6">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Project Title</label>
                                    <input type="text" id="p-title" required class="w-full px-4 py-2.5 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none" placeholder="e.g., Solar-Powered Water Purifier">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Category</label>
                                    <select id="p-category" class="w-full px-4 py-2.5 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none">
                                        <option>Sustainability</option>
                                        <option>HealthTech</option>
                                        <option>EdTech</option>
                                        <option>AI & ML</option>
                                        <option>IoT</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Funding Goal ($)</label>
                                    <input type="number" id="p-goal" required class="w-full px-4 py-2.5 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none" placeholder="1000">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Description</label>
                                    <textarea id="p-desc" required rows="4" class="w-full px-4 py-2.5 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none" placeholder="Describe your project detailedly for AI analysis..."></textarea>
                                </div>
                                
                                <!-- AI Validation Section -->
                                <div id="ai-section" class="bg-blue-50 rounded-xl p-5 border border-blue-100">
                                    <div class="flex items-center justify-between mb-2">
                                        <h4 class="font-bold text-blue-800">AI Feasibility Check</h4>
                                        <span id="ai-status" class="text-xs font-semibold text-blue-600 uppercase">Required</span>
                                    </div>
                                    <p class="text-sm text-blue-700/80 mb-4">Get instant feedback on your project's viability and boost your credit score.</p>
                                    
                                    <!-- Results Container (Hidden initially) -->
                                    <div id="ai-results" class="hidden mb-4 space-y-3 bg-white p-4 rounded-lg border border-blue-100">
                                        <div class="flex items-center gap-4">
                                            <div class="flex-1 text-center border-r border-gray-100">
                                                <div class="text-2xl font-bold text-gray-900" id="res-ai-score">--</div>
                                                <div class="text-xs text-gray-500 uppercase">Validation Score</div>
                                            </div>
                                            <div class="flex-1 text-center">
                                                <div class="text-2xl font-bold text-green-600" id="res-credit-score">--</div>
                                                <div class="text-xs text-gray-500 uppercase">New Credit Score</div>
                                            </div>
                                        </div>
                                        <div class="text-sm text-gray-600 italic" id="res-reasoning"></div>
                                    </div>

                                    <button type="button" onclick="validateIdea()" id="btn-validate" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-2.5 rounded-lg transition-colors flex items-center justify-center gap-2">
                                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>
                                        Validate & Generate Score
                                    </button>
                                </div>

                                <div class="pt-2">
                                    <button type="submit" id="btn-launch" disabled class="w-full bg-gray-300 text-gray-500 cursor-not-allowed font-semibold py-3 rounded-xl shadow-none transition-all">
                                        Launch Project
                                    </button>
                                    <p class="text-xs text-center text-gray-400 mt-2">You must validate your project before launching.</p>
                                </div>
                            </form>
                        </div>
                    </div>
                `;
        }
        // --- TRACK FUNDING / YOUR FUNDING ---
        else if (tabName === "Track Funding" || tabName === "Your Funding") {
          // Filter projects for 'Track Funding' to show user's projects (mocked by checking creator name or just showing all for demo)
          // For demo purposes, we'll just show the top few projects or the ones added by 'Alex Design'
          const displayProjects =
            userRole === "student"
              ? projects.filter((p) => p.creator === userStats.name)
              : projects.slice(0, 5); // Donors see portfolio

          container.innerHTML = `
                    <h2 class="text-xl font-bold text-gray-900 mb-6">${
                      tabName === "Track Funding"
                        ? "Your Active Projects"
                        : "Portfolio"
                    }</h2>
                    <div class="space-y-4">
                        ${
                          displayProjects.length > 0
                            ? displayProjects
                                .map((p) => createListCard(p))
                                .join("")
                            : '<div class="text-gray-500 italic">No projects found. Upload one!</div>'
                        }
                    </div>
                `;
        }
        // --- MESSAGES ---
        else if (tabName === "Messages") {
          container.innerHTML = `
                    <div class="max-w-3xl mx-auto bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden min-h-[400px] flex items-center justify-center flex-col p-8">
                        <div class="w-16 h-16 bg-blue-50 rounded-full flex items-center justify-center mb-4">
                            <svg class="w-8 h-8 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"></path></svg>
                        </div>
                        <h3 class="text-lg font-bold text-gray-900">No messages yet</h3>
                        <p class="text-gray-500 text-center mt-2">Connect with ${
                          userRole === "student" ? "donors" : "students"
                        } to start a conversation.</p>
                    </div>
                `;
        }
        // --- PROFILE ---
        else if (tabName === "Profile") {
          if (userRole === "student") {
            container.innerHTML = `
                        <div class="max-w-2xl mx-auto bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden">
                            <div class="h-32 gradient-bg"></div>
                            <div class="px-8 pb-8">
                                <div class="relative flex justify-between items-end -mt-12 mb-6">
                                    <div class="w-24 h-24 rounded-full border-4 border-white bg-white overflow-hidden shadow-md">
                                         <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=Alex" alt="Profile" class="w-full h-full object-cover">
                                    </div>
                                    <button class="px-4 py-2 bg-gray-100 text-gray-700 rounded-lg text-sm font-medium hover:bg-gray-200 transition-colors">Edit Profile</button>
                                </div>
                                <div>
                                    <h2 class="text-2xl font-bold text-gray-900">${userStats.name}</h2>
                                    <p class="text-gray-500 font-medium">Computer Science • Year 3</p>
                                    <div class="mt-6 grid grid-cols-3 gap-4 border-t border-b border-gray-100 py-6">
                                        <div class="text-center">
                                            <div class="text-2xl font-bold text-gray-900">${userStats.problemsUploaded}</div>
                                            <div class="text-xs text-gray-500 uppercase tracking-wide">Projects</div>
                                        </div>
                                        <div class="text-center border-l border-gray-100">
                                            <div class="text-2xl font-bold text-gray-900 profile-score-display">${userStats.creditScore}</div>
                                            <div class="text-xs text-gray-500 uppercase tracking-wide">Score</div>
                                        </div>
                                        <div class="text-center border-l border-gray-100">
                                            <div class="text-2xl font-bold text-gray-900">${userStats.raised}</div>
                                            <div class="text-xs text-gray-500 uppercase tracking-wide">Raised</div>
                                        </div>
                                    </div>
                                    <div class="mt-6">
                                        <h3 class="font-bold text-gray-900 mb-3">About</h3>
                                        <p class="text-gray-600 text-sm leading-relaxed">
                                            Passionate about using technology to solve real-world problems. Currently focused on sustainability and AI applications for environmental monitoring.
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
          } else {
            // Mock Donor Data
            const projectsFunded = userStats.approvedProjects + 5;
            const totalDonated = userStats.raised + 15000; // Just for demo difference
            const impactScore = 98;

            container.innerHTML = `
                        <div class="max-w-2xl mx-auto bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden">
                            <div class="h-32 bg-gradient-to-r from-purple-600 to-indigo-600"></div>
                            <div class="px-8 pb-8">
                                <div class="relative flex justify-between items-end -mt-12 mb-6">
                                    <div class="w-24 h-24 rounded-full border-4 border-white bg-white overflow-hidden shadow-md">
                                            <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=DonorUser&style=circle" alt="Profile" class="w-full h-full object-cover">
                                    </div>
                                    <button class="px-4 py-2 bg-gray-100 text-gray-700 rounded-lg text-sm font-medium hover:bg-gray-200 transition-colors">Edit Preferences</button>
                                </div>
                                <div>
                                    <h2 class="text-2xl font-bold text-gray-900">${
                                      userStats.name === "Shamil SJ"
                                        ? "Investor Account"
                                        : userStats.name
                                    }</h2>
                                    <p class="text-gray-500 font-medium">Angel Donor • Platinum Member</p>
                                    <div class="mt-6 grid grid-cols-3 gap-4 border-t border-b border-gray-100 py-6">
                                        <div class="text-center">
                                            <div class="text-2xl font-bold text-gray-900">${projectsFunded}</div>
                                            <div class="text-xs text-gray-500 uppercase tracking-wide">Funded</div>
                                        </div>
                                        <div class="text-center border-l border-gray-100">
                                            <div class="text-2xl font-bold text-gray-900 text-purple-600">${impactScore}</div>
                                            <div class="text-xs text-gray-500 uppercase tracking-wide">Impact Score</div>
                                        </div>
                                        <div class="text-center border-l border-gray-100">
                                            <div class="text-2xl font-bold text-gray-900">${totalDonated.toLocaleString()}</div>
                                            <div class="text-xs text-gray-500 uppercase tracking-wide">Donated</div>
                                        </div>
                                    </div>
                                    <div class="mt-6">
                                        <h3 class="font-bold text-gray-900 mb-3">Investment Focus</h3>
                                        <div class="flex flex-wrap gap-2">
                                            <span class="px-3 py-1 bg-green-50 text-green-700 text-xs font-semibold rounded-full">Sustainability</span>
                                            <span class="px-3 py-1 bg-blue-50 text-blue-700 text-xs font-semibold rounded-full">HealthTech</span>
                                            <span class="px-3 py-1 bg-purple-50 text-purple-700 text-xs font-semibold rounded-full">AI Startups</span>
                                        </div>
                                        <h3 class="font-bold text-gray-900 mt-6 mb-3">Bio</h3>
                                        <p class="text-gray-600 text-sm leading-relaxed">
                                            Dedicated to empowering the next generation of innovators. Looking for high-impact projects in renewable energy and accessible healthcare technologies.
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
          }
        }
      }

      function createProjectCard(p) {
        const percent = Math.min(100, Math.round((p.raised / p.goal) * 100));
        return `
            <div class="bg-white rounded-2xl overflow-hidden border border-gray-100 shadow-sm project-card flex flex-col h-full">
                <div class="relative h-48 overflow-hidden">
                    <img src="${
                      p.image
                    }" class="w-full h-full object-cover transition-transform duration-700 hover:scale-110" alt="${
          p.title
        }">
                    <div class="absolute top-3 left-3 bg-white/90 backdrop-blur-sm px-2 py-1 rounded-lg text-xs font-bold text-gray-700 shadow-sm">
                        ${p.category}
                    </div>
                    <div class="absolute top-3 right-3 bg-black/60 backdrop-blur-sm px-2 py-1 rounded-lg text-xs font-bold text-white flex items-center gap-1">
                        <svg class="w-3 h-3 text-yellow-400" fill="currentColor" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path></svg>
                        AI Score: ${p.score}
                    </div>
                </div>
                <div class="p-5 flex flex-col flex-1">
                    <h3 class="font-bold text-lg text-gray-900 leading-tight mb-1">${
                      p.title
                    }</h3>
                    <p class="text-xs text-gray-500 font-medium mb-3">by ${
                      p.creator
                    }</p>
                    <p class="text-sm text-gray-600 mb-4 line-clamp-2">${
                      p.desc
                    }</p>
                    
                    <div class="mt-auto space-y-3">
                        <div>
                            <div class="flex justify-between text-xs font-bold text-gray-700 mb-1">
                                <span>${p.raised} raised</span>
                                <span class="text-gray-400">of ${p.goal}</span>
                            </div>
                            <div class="w-full bg-gray-100 rounded-full h-2 overflow-hidden">
                                <div class="gradient-bg h-full rounded-full" style="width: ${percent}%"></div>
                            </div>
                        </div>
                        <button onclick="handleCardAction(${
                          p.id
                        })" class="w-full py-2.5 rounded-xl text-sm font-semibold transition-all
                            ${
                              userRole === "donor"
                                ? "gradient-bg text-white shadow-lg hover:shadow-blue-500/30 hover:-translate-y-0.5"
                                : "bg-gray-50 text-gray-900 hover:bg-gray-100 border border-gray-200"
                            }">
                            ${
                              userRole === "donor" ? "Fund Now" : "View Details"
                            }
                        </button>
                    </div>
                </div>
            </div>
            `;
      }

      function createListCard(p) {
        const percent = Math.min(100, Math.round((p.raised / p.goal) * 100));
        return `
                <div class="bg-white p-4 rounded-xl border border-gray-100 flex gap-4 items-center shadow-sm hover:shadow-md transition-shadow">
                    <img src="${p.image}" class="w-20 h-20 rounded-lg object-cover" alt="${p.title}">
                    <div class="flex-1 min-w-0">
                        <h4 class="font-bold text-gray-900 truncate">${p.title}</h4>
                        <div class="text-xs text-gray-500 mb-2">AI Score: ${p.score} • ${p.category}</div>
                        <div class="w-full bg-gray-100 rounded-full h-1.5 overflow-hidden">
                            <div class="gradient-bg h-full rounded-full" style="width: ${percent}%"></div>
                        </div>
                    </div>
                    <div class="text-right pl-2">
                        <span class="block font-bold text-gray-900">${percent}%</span>
                        <span class="text-xs text-green-600 font-medium">Active</span>
                    </div>
                </div>
             `;
      }

      // --- NEW FUNCTIONALITY ---

      let currentValidationResult = null;

      async function validateIdea() {
        const description = document.getElementById("p-desc").value;
        const title = document.getElementById("p-title").value;
        const btn = document.getElementById("btn-validate");
        const resultsArea = document.getElementById("ai-results");

        if (!description || description.length < 20) {
          alert("Please provide a detailed description first.");
          return;
        }

        // UI Loading State
        const originalText = btn.innerHTML;
        btn.disabled = true;
        btn.innerHTML =
          '<svg class="animate-spin h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg> Analyzing...';

        const renderSuccess = (result, isSimulated = false) => {
          currentValidationResult = result;

          // Update UI with results
          resultsArea.classList.remove("hidden");
          document.getElementById("res-ai-score").innerText =
            result.ai_validation_score;
          document.getElementById("res-credit-score").innerText =
            result.credit_score;
          document.getElementById("res-reasoning").innerHTML = `
                    ${
                      isSimulated
                        ? '<div class="text-xs bg-yellow-100 text-yellow-800 p-2 rounded mb-2 font-semibold"></div>'
                        : ""
                    }
                    <strong>AI Analysis:</strong> ${
                      result.reasoning.ai_score_reason
                    }<br><br><strong>Credit Update:</strong> ${
            result.reasoning.credit_score_reason
          }
                `;

          // Enable Launch Button
          const launchBtn = document.getElementById("btn-launch");
          launchBtn.disabled = false;
          launchBtn.classList.remove(
            "bg-gray-300",
            "text-gray-500",
            "cursor-not-allowed"
          );
          launchBtn.classList.add(
            "gradient-bg",
            "text-white",
            "shadow-lg",
            "hover:shadow-xl"
          );

          // Change Validate button state
          btn.innerHTML = "<span>✓ Analysis Complete</span>";
          btn.classList.remove("bg-blue-600", "hover:bg-blue-700");
          btn.classList.add("bg-green-600", "hover:bg-green-700");
        };

        // Fallback Function
        const useMockData = () => {
          console.warn("Using Mock Data Fallback");
          const baseScore = 70 + Math.floor(Math.random() * 25);
          const mockResult = {
            ai_validation_score: baseScore,
            credit_score: Math.min(
              100,
              userStats.creditScore + Math.floor(Math.random() * 5) + 1
            ),
            reasoning: {
              ai_score_reason:
                "The project addresses a relevant problem with a standard technical approach. Innovation score is moderate based on current market trends.",
              credit_score_reason:
                "Your consistent activity on the platform has been recognized, resulting in a positive credit adjustment.",
            },
            summary:
              "A viable project that meets the basic criteria for funding eligibility.",
          };
          renderSuccess(mockResult, true);
        };

        // Prepare Prompt
        const prompt = `
            You are an AI evaluator for a student innovation and funding platform.
            
            PROJECT IDEA: ${title} - ${description}

            NUMBER OF PROBLEMS UPLOADED: ${userStats.problemsUploaded}
            NUMBER OF APPROVED PROJECTS BY DONORS: ${userStats.approvedProjects}
            ACTIVENESS SCORE (0–10): ${userStats.activeness}

            Respond ONLY in this JSON format:
            {
            "ai_validation_score": number(0-100),
            "credit_score": number(0-100),
            "reasoning": {
                "ai_score_reason": "Short explanation",
                "credit_score_reason": "Short explanation"
            },
            "summary": "One sentence evaluation"
            }
            `;

        try {
          const response = await fetch(
            "https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${GEMINI_API_KEY}",
            {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({
                contents: [{ parts: [{ text: prompt }] }],
              }),
            }
          );

          if (!response.ok) {
            throw new Error(`API Error: ${response.status}`);
          }

          const data = await response.json();

          if (!data.candidates || !data.candidates[0]) {
            throw new Error("No candidates returned");
          }

          // Parse response
          const rawText = data.candidates[0].content.parts[0].text;
          const jsonStr = rawText.replace(/json|/g, "").trim();
          const result = JSON.parse(jsonStr);

          renderSuccess(result, false);
        } catch (error) {
          console.error("Gemini API Error:", error);
          useMockData();
        }
      }

      async function handleProjectUpload(e) {
        e.preventDefault();

        const title = document.getElementById("p-title").value;
        const category = document.getElementById("p-category").value;
        const goal = document.getElementById("p-goal").value;
        const desc = document.getElementById("p-desc").value;

        if (!currentValidationResult) {
          alert("Please validate your project first.");
          return;
        }

        const newProject = {
          id: projects.length + 1,
          title: title,
          creator: userStats.name,
          role: "Computer Science Student",
          desc: desc,
          image: "https://images.unsplash.com/photo-1518770660439-4636190af475?auto=format&fit=crop&q=80&w=800", // Default fallback image since source.unsplash is deprecated/unreliable
          goal: parseInt(goal),
          raised: 0,
          score: currentValidationResult.ai_validation_score,
          category: category,
          createdAt: new Date().toISOString(),
        };

        // 1. Update Local State
        projects.unshift(newProject); // Add to top

        // Update User Stats
        userStats.problemsUploaded++;
        userStats.creditScore = currentValidationResult.credit_score;

        // 2. Try Firebase Upload (Fire & Forget)
        if (db) {
          try {
            await db.collection("projects").add(newProject);
            console.log("Project saved to Firestore");
          } catch (err) {
            console.error("Firestore save failed:", err);
          }
        }

        // 3. Feedback & Redirect
        const btn = document.getElementById("btn-launch");
        btn.innerHTML = "🚀 Launching...";

        setTimeout(() => {
          alert(
            `Project Launched Successfully!\nYour new Credit Score is ${userStats.creditScore}`
          );
          switchDashboardTab("Home Feed");

          // Force refresh of profile UI if needed
          document.querySelector(".profile-score-display").innerText =
            userStats.creditScore;
        }, 1000);
      }

      // --- MODAL LOGIC ---

      function handleCardAction(id) {
        const project = projects.find((p) => p.id === id);
        if (!project) return;

        if (userRole === "student") {
          openDetailsModal(project);
        } else {
          openFundingModal(project);
        }
      }

      function openDetailsModal(p) {
        const modal = document.getElementById("universal-modal");
        const content = document.getElementById("modal-content");
        const backdrop = document.getElementById("modal-backdrop");

        modal.classList.remove("hidden");
        // Trigger animations
        setTimeout(() => {
          backdrop.classList.remove("opacity-0");
          content.classList.remove("scale-95", "opacity-0");
        }, 10);

        const percent = Math.min(100, Math.round((p.raised / p.goal) * 100));

        content.innerHTML = `
                <div class="relative h-64 shrink-0 group">
                    <img src="${
                      p.image
                    }" class="w-full h-full object-cover" alt="${p.title}">
                    <div class="absolute inset-0 bg-gradient-to-t from-black/80 via-black/20 to-transparent"></div>
                    <button onclick="closeModal()" class="absolute top-4 right-4 bg-black/20 hover:bg-black/40 text-white p-2 rounded-full backdrop-blur-md transition-colors">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                    </button>
                    <div class="absolute bottom-4 left-6 text-white max-w-[80%]">
                        <div class="inline-block px-2 py-1 rounded-lg bg-blue-600/80 backdrop-blur-sm text-xs font-bold mb-2 border border-blue-400/30">${
                          p.category
                        }</div>
                        <h2 class="text-3xl font-bold leading-tight">${
                          p.title
                        }</h2>
                    </div>
                </div>
                <div class="p-8 overflow-y-auto custom-scrollbar">
                    <div class="flex items-center gap-4 mb-8 pb-6 border-b border-gray-100">
                        <div class="w-12 h-12 rounded-full bg-gradient-to-br from-blue-100 to-indigo-100 flex items-center justify-center font-bold text-blue-600 text-lg">
                            ${p.creator.charAt(0)}
                        </div>
                        <div>
                            <div class="font-bold text-gray-900 text-lg">${
                              p.creator
                            }</div>
                            <div class="text-sm text-gray-500">${p.role}</div>
                        </div>
                        <div class="ml-auto flex flex-col items-end bg-blue-50 px-4 py-2 rounded-xl border border-blue-100">
                             <div class="text-2xl font-bold text-blue-600">${
                               p.score
                             }</div>
                             <div class="text-[10px] font-bold text-blue-400 uppercase tracking-wider">AI Score</div>
                        </div>
                    </div>
                    
                    <div class="mb-8">
                        <h3 class="text-lg font-bold text-gray-900 mb-3 flex items-center gap-2">
                            <svg class="w-5 h-5 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                            About the Project
                        </h3>
                        <p class="text-gray-600 leading-relaxed text-base">${
                          p.desc
                        }</p>
                    </div>
                    
                    <div class="bg-gray-50 rounded-2xl p-6 border border-gray-100">
                        <div class="flex justify-between items-end mb-3">
                            <div>
                                <div class="text-sm font-medium text-gray-500 mb-1">Total Raised</div>
                                <div class="text-3xl font-bold text-gray-900 tracking-tight">${p.raised.toLocaleString()}</div>
                            </div>
                            <div class="text-right">
                                <div class="text-sm font-medium text-gray-500 mb-1">Funding Goal</div>
                                <div class="text-xl font-semibold text-gray-700">${p.goal.toLocaleString()}</div>
                            </div>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-4 overflow-hidden mb-3 shadow-inner">
                            <div class="gradient-bg h-full rounded-full transition-all duration-1000 relative" style="width: ${percent}%">
                                <div class="absolute inset-0 bg-white/20 animate-pulse"></div>
                            </div>
                        </div>
                        <div class="flex justify-between items-center">
                             <div class="text-sm text-blue-600 font-bold">${percent}% Funded</div>
                             <div class="text-xs text-gray-400">Campaign Active</div>
                        </div>
                    </div>
                </div>
            `;
      }

      function openFundingModal(p) {
        const modal = document.getElementById("universal-modal");
        const content = document.getElementById("modal-content");
        const backdrop = document.getElementById("modal-backdrop");

        modal.classList.remove("hidden");
        setTimeout(() => {
          backdrop.classList.remove("opacity-0");
          content.classList.remove("scale-95", "opacity-0");
        }, 10);

        content.innerHTML = `
                <div class="p-8 h-full flex flex-col">
                    <div class="flex justify-between items-start mb-6">
                        <div>
                            <h2 class="text-2xl font-bold text-gray-900">Fund Project</h2>
                            <p class="text-gray-500 mt-1">Supporting <strong class="text-blue-600">${p.title}</strong></p>
                        </div>
                        <button onclick="closeModal()" class="text-gray-400 hover:text-gray-600 transition-colors bg-gray-50 p-2 rounded-full">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                        </button>
                    </div>

                    <div class="mb-8 bg-blue-50/50 p-6 rounded-2xl border border-blue-100">
                         <label class="block text-sm font-bold text-gray-700 mb-3 uppercase tracking-wide">Enter Donation Amount</label>
                         <div class="relative mb-4">
                            <span class="absolute left-5 top-1/2 -translate-y-1/2 text-gray-400 font-bold text-xl">$</span>
                            <input type="number" id="fund-amount" class="w-full pl-10 pr-4 py-4 text-3xl font-bold text-gray-900 border border-gray-200 rounded-xl focus:ring-4 focus:ring-blue-100 focus:border-blue-500 outline-none transition-all bg-white shadow-sm" placeholder="0" min="1">
                         </div>
                         <div class="flex gap-2">
                            <button onclick="setAmount(10)" class="flex-1 py-2 text-sm font-medium border border-blue-200 bg-white rounded-lg hover:bg-blue-50 text-blue-600 transition-colors">$10</button>
                            <button onclick="setAmount(50)" class="flex-1 py-2 text-sm font-medium border border-blue-200 bg-white rounded-lg hover:bg-blue-50 text-blue-600 transition-colors">$50</button>
                            <button onclick="setAmount(100)" class="flex-1 py-2 text-sm font-medium border border-blue-200 bg-white rounded-lg hover:bg-blue-50 text-blue-600 transition-colors">$100</button>
                            <button onclick="setAmount(500)" class="flex-1 py-2 text-sm font-medium border border-blue-200 bg-white rounded-lg hover:bg-blue-50 text-blue-600 transition-colors">$500</button>
                         </div>
                    </div>

                    <div class="mt-auto">
                        <button onclick="processPayment(${p.id})" class="w-full gradient-bg text-white font-bold py-4 rounded-xl shadow-lg shadow-blue-500/20 hover:shadow-blue-500/40 hover:-translate-y-0.5 transition-all flex justify-center items-center gap-2">
                            <span>Confirm Contribution</span>
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"></path></svg>
                        </button>
                        
                        <p class="text-xs text-center text-gray-400 mt-4 flex items-center justify-center gap-1.5">
                            <svg class="w-3 h-3 text-green-500" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z"/></svg>
                            <span>Payments processed securely via Stripe</span>
                        </p>
                    </div>
                </div>
            `;
      }

      function setAmount(val) {
        document.getElementById("fund-amount").value = val;
      }

      function closeModal() {
        const modal = document.getElementById("universal-modal");
        const content = document.getElementById("modal-content");
        const backdrop = document.getElementById("modal-backdrop");

        backdrop.classList.add("opacity-0");
        content.classList.add("scale-95", "opacity-0");

        setTimeout(() => {
          modal.classList.add("hidden");
        }, 300);
      }

      function processPayment(id) {
        const amountInput = document.getElementById("fund-amount");
        const amount = parseInt(amountInput.value);

        if (!amount || amount <= 0) {
          alert("Please enter a valid amount");
          return;
        }

        const btn = document.querySelector(
          '#modal-content button[onclick^="processPayment"]'
        );
        const originalText = btn.innerHTML;
        btn.innerHTML =
          '<svg class="animate-spin h-5 w-5 text-white mx-auto" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>';

        setTimeout(() => {
          // Find project
          const project = projects.find((p) => p.id === id);
          if (project) {
            project.raised += amount;
            // Update User Stats if donor (mock)
            userStats.raised += amount;

            // If Firebase is connected, update there too (mocking for now)
            if (db) {
              // In a real app we'd update firestore document
              console.log("Would update Firestore project raised amount");
            }
          }

          // Re-render current view to show progress update
          const activeTabBtn = document.querySelector(
            ".dashboard-tab.bg-white.text-blue-600"
          );
          if (activeTabBtn) {
            renderContent(activeTabBtn.dataset.tab);
          }

          closeModal();

          // Show success toast
          const toast = document.createElement("div");
          toast.className =
            "fixed bottom-8 left-1/2 transform -translate-x-1/2 bg-gray-900 text-white px-6 py-3 rounded-full shadow-2xl z-[200] flex items-center gap-3 animate-bounce";
          toast.innerHTML = `
                    <svg class="w-5 h-5 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>
                    <span class="font-medium">Successfully funded ${amount}!</span>
                `;
          document.body.appendChild(toast);

          setTimeout(() => toast.remove(), 3000);
        }, 1500);
      }
    </script>
  </body>
</html>